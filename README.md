# Микросервисное приложение для работы с данными торгов

## Описание

Данное микросервисное приложение предназначено для работы с данными из таблицы `spimex_trading_results`. Оно предоставляет API для получения данных в формате JSON, включая информацию о последних торговых днях, динамике торгов и последних результатах торгов.

## Функциональность

Приложение реализует следующие функции:

1. **get_last_trading_dates**
   - **Описание**: Возвращает список дат последних торговых дней.
   - **Параметры**:
     - `count` (обязательный): Количество последних торговых дней для получения.
   - **Пример запроса**: `GET /api/trading-dates?count=5`

2. **get_dynamics**
   - **Описание**: Возвращает список торгов за заданный период.
   - **Параметры**:
     - `oil_id` (необязательный, для фильтрации): Идентификатор нефти.
     - `delivery_type_id` (необязательный, для фильтрации): Идентификатор типа доставки.
     - `delivery_basis_id` (необязательный, для фильтрации): Идентификатор базы доставки.
     - `start_date` (обязательный): Дата начала периода.
     - `end_date` (обязательный): Дата окончания периода.
   - **Пример запроса**: `GET /api/dynamics?oil_id=1&start_date=2023-01-01&end_date=2023-01-31`

3. **get_trading_results**
   - **Описание**: Возвращает список последних торгов.
   - **Параметры**:
     - `oil_id` (необязательный, для фильтрации): Идентификатор нефти.
     - `delivery_type_id` (необязательный, для фильтрации): Идентификатор типа доставки.
     - `delivery_basis_id` (необязательный, для фильтрации): Идентификатор базы доставки.
   - **Пример запроса**: `GET /api/trading-results?oil_id=1`

## Кэширование

Для оптимизации работы приложения реализовано кэширование запросов с использованием Redis. Кэш будет хранить данные до 14:11 каждого дня, после чего будет происходить сброс всего кэша. Это позволяет уменьшить нагрузку на базу данных и ускорить время отклика API.

## Установка

1. Клонируйте данный репозиторий к себе на локальную машину: git clone https://github.com/valyaplotnikova/FastApi-STR.git

2. В файлах .env.example подставьте свои переменные окружения и переименуйте файлы в .env

3. Запустите Docker   
Введите команду в терминале(выполнение команды осуществляется из папки проекта):    

Для Compose V1:

```
docker-compose up -d --build 
```
Для Compose V2:
```
docker compose up -d --build 
```
4. Дождитесь пока данные спарсятся с сайта и загрузятся в базу данных
5. Сервис готов для использования по адресу http://0.0.0.0:8000